<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>QR Secure Sense — Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:Arial;background:#071024;color:#e6eef6;padding:24px}
    .card{background:#0f1726;padding:16px;border-radius:10px;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .small{color:#9aa4b2}
  </style>
</head>
<body>
  <h1>Admin Dashboard</h1>

  <div class="grid">
    <div class="card">
      <h3>Total Scans</h3>
      <div id="totalScans" style="font-size:28px">—</div>
      <div class="small">Number of simulated scans logged</div>
    </div>

    <div class="card">
      <h3>Average Fake Risk</h3>
      <div id="avgRisk" style="font-size:28px">—</div>
      <div class="small">Average fake risk score (%)</div>
    </div>

    <div class="card">
      <h3>Survey Responses</h3>
      <div id="surveyCount" style="font-size:28px">—</div>
      <div class="small">Number of feedback submissions</div>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3>Risk Over Time</h3>
    <canvas id="scanChart" style="height:240px"></canvas>
  </div>

  <script>
    async function loadDashboard(){
      const s = await fetch('/api/stats').then(r=>r.json());
      document.getElementById('totalScans').textContent = s.scansCount ?? 0;
      document.getElementById('avgRisk').textContent = (s.avgRisk ?? 0) + ' %';
      document.getElementById('surveyCount').textContent = s.surveysCount ?? 0;

      const scans = await fetch('/api/scans').then(r=>r.json());
      const labels = scans.map((x,i)=> new Date(x.time).toLocaleTimeString());
      const values = scans.map(x=>x.risk);

      const ctx = document.getElementById('scanChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: { labels, datasets: [{ label: 'Fake Risk', data: values, fill:false }] },
        options: { scales:{ y:{min:0,max:100} } }
      });
    }

    loadDashboard();
  </script>
</body>
</html>
