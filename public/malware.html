<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>System Alert — QR Secure Sense (Simulation)</title>

  <!-- Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#0b1020; --card:#0f1726; --accent:#ff6b6b; --ok:#22c55e; --muted:#9aa4b2;
      color-scheme: dark;
    }
    body{font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#05060a, #071024);margin:0;padding:32px;color:#e6eef6;}
    .container{max-width:980px;margin:0 auto;}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{margin:0;font-size:20px}
    .notice{color:var(--accent);font-weight:700}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;margin-top:18px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    .row{display:flex;gap:16px;align-items:flex-start}
    .col{flex:1}
    .left{min-width:320px}
    .terminal{background:#000000; color:#66ff66; font-family:monospace; padding:14px; border-radius:8px; height:160px; overflow:auto; box-shadow:inset 0 0 8px rgba(0,0,0,0.6)}
    .progress{height:12px;background:#0b1220;border-radius:8px;overflow:hidden;margin-top:12px}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,#ff7a7a,#ffd27a);width:0%}
    .proc-list{list-style:none;padding:0;margin:0;max-height:220px;overflow:auto}
    .proc{display:flex;justify-content:space-between;padding:8px 10px;border-bottom:1px dashed rgba(255,255,255,0.03);align-items:center}
    .proc .meta{font-size:13px;color:var(--muted)}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;background:#1f2937;color:#fff}
    .btn-danger{background:var(--accent)}
    .btn-ok{background:var(--ok); color:black; font-weight:600}
    .small{font-size:13px;color:var(--muted)}
    #resultBox{margin-top:12px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.01)}
    .hidden{display:none}
    .wizard{margin-top:12px}
    .wizard li{margin:6px 0}
    .quiz{margin-top:8px}
    .qr-hint{font-size:13px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>QR Secure Sense — Simulation</h1>
        <div class="small">Educational simulation only — no files will be executed or installed.</div>
      </div>
      <div class="notice">⚠ Simulation Mode — Consent Required</div>
    </div>

    <div class="card">
      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;">
        <div>
          <strong>Detected: Suspicious activity (simulated)</strong>
          <div class="small">This page demonstrates a fake “infection” for awareness purposes. Continue only if you consent.</div>
        </div>
        <div>
          <button id="consentBtn" class="btn">I Consent</button>
          <button id="exitBtn" class="btn" style="background:#222">Exit</button>
        </div>
      </div>

      <div id="simulationArea" class="hidden">
        <div class="row" style="margin-top:16px;">
          <div class="col left">
            <div class="card">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div><strong>Live Scan</strong><div class="small">Simulating device checks</div></div>
                <div class="small">Status: <span id="scanStatus">Idle</span></div>
              </div>

              <div class="terminal" id="terminal">
                <!-- simulated terminal output goes here -->
                <div id="initialMsg">Initializing safe simulation engine...</div>
              </div>

              <div class="progress" aria-hidden>
                <i id="progressBar"></i>
              </div>

              <div id="resultBox"></div>
            </div>

            <div class="card" style="margin-top:12px;">
              <strong>Fake Running Processes</strong>
              <ul class="proc-list" id="procList"></ul>
            </div>
          </div>

          <div class="col">
            <div class="card">
              <strong>System Telemetry (Simulated)</strong>
              <canvas id="cpuChart" style="width:100%;height:180px"></canvas>
            </div>

            <div class="card" style="margin-top:12px;">
              <strong>Remediation Wizard</strong>
              <ul class="wizard" id="wizard">
                <li><input type="checkbox" id="w1"> Close suspicious apps</li>
                <li><input type="checkbox" id="w2"> Clear browser cache (instructions provided)</li>
                <li><input type="checkbox" id="w3"> Update OS & apps</li>
                <li><input type="checkbox" id="w4"> Run official campus antivirus</li>
              </ul>
              <button id="completeBtn" class="btn btn-ok" style="margin-top:8px">Mark as Resolved (Sim)</button>
            </div>

            <div class="card" style="margin-top:12px;">
              <strong>Quick Quiz (Awareness)</strong>
              <div class="quiz">
                <div>1) Should you install random apps prompted by pop-ups?</div>
                <label><input name="q1" type="radio" value="a"> Yes</label>
                <label><input name="q1" type="radio" value="b"> No</label>
                <div style="margin-top:8px"><button id="submitQuiz" class="btn">Submit Quiz</button></div>
                <div id="quizResult" class="small"></div>
              </div>
            </div>

            <div class="card" style="margin-top:12px;">
              <strong>Share / Demo</strong>
              <div class="qr-hint">Use your QR generator to point to <code>/fake-malware</code> so visitors scan and see this simulation.</div>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>

  <script>
    // ---- Safety & Consent ----
    const consentBtn = document.getElementById('consentBtn');
    const exitBtn = document.getElementById('exitBtn');
    const sim = document.getElementById('simulationArea');
    const terminal = document.getElementById('terminal');
    const progressBar = document.getElementById('progressBar');
    const scanStatus = document.getElementById('scanStatus');
    const resultBox = document.getElementById('resultBox');
    const procList = document.getElementById('procList');
    const completeBtn = document.getElementById('completeBtn');

    exitBtn.addEventListener('click', () => {
      // Safe exit — redirect to campus home or instructions
      window.location.href = "https://www.google.com";
    });

    consentBtn.addEventListener('click', () => {
      sim.classList.remove('hidden');
      consentBtn.disabled = true;
      startSimulation();
    });

    // ---- Fake process data (fictional names only) ----
    const fakeProcs = [
      {name:"svc-sync.exe", pid:4210, mem:"32MB"},
      {name:"net-helper", pid:992, mem:"18MB"},
      {name:"bg-stats", pid:1104, mem:"14MB"},
      {name:"updater-proxy", pid:2211, mem:"28MB"},
      {name:"ad-popup-sim", pid:5523, mem:"40MB"}
    ];

    // ---- Terminal output helper ----
    function appendLine(txt){
      const div = document.createElement('div');
      div.textContent = txt;
      terminal.appendChild(div);
      terminal.scrollTop = terminal.scrollHeight;
    }

    // ---- Simulation steps ----
    const steps = [
      {t:"Collecting system info...", wait:900},
      {t:"Analyzing installed apps (safe simulation)...", wait:1200},
      {t:"Monitoring background network connections...", wait:1200},
      {t:"Scanning installed certificates (simulated)...", wait:900},
      {t:"Correlating suspicious indicators...", wait:1800}
    ];

    async function startSimulation(){
      scanStatus.textContent = "Running";
      // animate
      let total = steps.reduce((s,x)=>s+x.wait,0);
      let elapsed = 0;

      for (let s of steps){
        appendLine("> " + s.t);
        await new Promise(r=>setTimeout(r,s.wait));
        elapsed += s.wait;
        progressBar.style.width = Math.round((elapsed/total)*100) + "%";
      }

      // populate fake process list
      procList.innerHTML = "";
      fakeProcs.forEach(p=>{
        const li = document.createElement('li');
        li.className = 'proc';
        li.innerHTML = `
          <div>
            <div style="font-weight:700">${p.name} <span class="small">PID:${p.pid}</span></div>
            <div class="meta">${p.mem} • Unknown vendor</div>
          </div>
          <div>
            <button class="btn btn-danger" onclick="simulateKill(this)">End</button>
          </div>
        `;
        procList.appendChild(li);
      });

      // fake telemetry animation (chart)
      startCharts();

      // log the simulated scan to server (anonymous)
      try {
        fetch('/log-scan', { method:'POST' });
      } catch (e){ /* fail silently; offline demo okay */ }

      appendLine("=== Simulation complete. No real malware found ===");
      scanStatus.textContent = "Complete (demo)";
      resultBox.innerHTML = "<div style='color:var(--ok);font-weight:700'>No real malware detected — educational simulation only.</div>";
    }

    // Simulate killing a process (UI-only)
    function simulateKill(btn){
      btn.textContent = "Closing...";
      btn.disabled = true;
      setTimeout(()=>{
        const li = btn.closest('li');
        li.style.opacity = 0.5;
        appendLine("> Closed process " + li.querySelector('div > div').innerText.split(' PID:')[0].trim());
      },800);
    }

    // ---- Charts (simulated CPU / network) ----
    let cpuChart;
    function startCharts(){
      const ctx = document.getElementById('cpuChart').getContext('2d');
      const data = { labels:[], datasets:[{label:'CPU (simulated)', data:[], fill:true, tension:0.3}] };
      cpuChart = new Chart(ctx, {
        type:'line',
        data,
        options:{ animation:false, scales:{ y:{min:0,max:100} } }
      });

      // feed simulated values
      let t=0;
      const feed = setInterval(()=>{
        if (t>30) { clearInterval(feed); return; }
        if (data.labels.length>30){ data.labels.shift(); data.datasets[0].data.shift(); }
        data.labels.push('');
        // random but slightly increasing values when "suspicious proc" present
        const val = Math.round(25 + Math.random()*40 + (t>10? Math.random()*20:0));
        data.datasets[0].data.push(val);
        cpuChart.update();
        t++;
      }, 700);
    }

    // ---- Quiz handling ----
    document.getElementById('submitQuiz').addEventListener('click', ()=>{
      const answer = document.querySelector('input[name="q1"]:checked');
      const out = document.getElementById('quizResult');
      if (!answer){ out.textContent = "Please choose an answer."; return; }
      if (answer.value === 'b'){ out.textContent = "Correct — never install apps from pop-ups. Good job!"; out.style.color='var(--ok)'; }
      else { out.textContent = "Incorrect — do not install apps from pop-ups. Choose 'No'."; out.style.color='var(--accent)'; }
    });

    // ---- Remediation completion (UI-only) ----
    completeBtn.addEventListener('click', ()=>{
      const done = Array.from(document.querySelectorAll('.wizard input')).every(i=>i.checked);
      if (!done) {
        alert("Please follow all recommended steps in the remediation checklist (simulation).");
        return;
      }
      resultBox.innerHTML = "<div style='font-weight:700;color:var(--ok)'>Marked resolved (simulation). Well done!</div>";
    });

    // Accessibility: keyboard exit
    document.addEventListener('keydown', e=>{
      if (e.key === 'Escape') window.location.href = '/';
    });

    // Safety notice (explicit)
    appendLine("NOTICE: This is a harmless, educational simulation. No files are accessed, modified, or executed on your device.");
  </script>
</body>
</html>
